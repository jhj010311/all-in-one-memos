# ê³µë™êµ¬ë§¤ ì±„íŒ… ì„œë¹„ìŠ¤ êµ¬ì¶• ê°€ì´ë“œ

## 1. ì‹¤ì‹œê°„ í†µì‹  ê¸°ìˆ 

### WebSocket vs Server-Sent Events (SSE)
- **WebSocket**: ì–‘ë°©í–¥ ì‹¤ì‹œê°„ í†µì‹ , ì±„íŒ…ì— ìµœì 
- **SSE**: ì„œë²„â†’í´ë¼ì´ì–¸íŠ¸ ë‹¨ë°©í–¥, ì•Œë¦¼ìš©ìœ¼ë¡œ ì í•©

### Spring Boot WebSocket êµ¬ì„±
```java
@Configuration
@EnableWebSocket
public class WebSocketConfig implements WebSocketConfigurer {
    @Override
    public void registerWebSocketHandlers(WebSocketHandlerRegistry registry) {
        registry.addHandler(new ChatWebSocketHandler(), "/chat/{roomId}")
                .setAllowedOrigins("*");
    }
}
```

## 2. ì±„íŒ…ë°© êµ¬ì¡° ì„¤ê³„

### ì±„íŒ…ë°© ìƒì„± ì‹œì 
- ìƒí’ˆ í˜ì´ì§€ ìƒì„± ì‹œ ìë™ìœ¼ë¡œ ì±„íŒ…ë°© ìƒì„±
- ì±„íŒ…ë°© ID = ìƒí’ˆ IDë¡œ ë§¤í•‘

### ì±„íŒ…ë°© ìƒíƒœ ê´€ë¦¬
- **ACTIVE**: ëª¨ì§‘ ì¤‘
- **CLOSED**: ëª¨ì§‘ ì™„ë£Œ
- **CANCELLED**: ëª¨ì§‘ ì·¨ì†Œ

### ì°¸ì—¬ì ê´€ë¦¬
- ë™ì  ì°¸ì—¬/ì´íƒˆ ì²˜ë¦¬
- ìµœëŒ€ ì¸ì› ì œí•œ ì²´í¬
- ëª¨ì§‘ ì™„ë£Œ ì‹œ ë¯¸ì°¸ì—¬ì ìë™ ì œê±°

## 3. React í”„ë¡ íŠ¸ì—”ë“œ êµ¬í˜„

### WebSocket ì—°ê²° ê´€ë¦¬
```javascript
const useWebSocket = (roomId) => {
  const [socket, setSocket] = useState(null);
  const [messages, setMessages] = useState([]);

  useEffect(() => {
    const ws = new WebSocket(`ws://localhost:8080/chat/${roomId}`);
    
    ws.onmessage = (event) => {
      const message = JSON.parse(event.data);
      setMessages(prev => [...prev, message]);
    };

    setSocket(ws);
    return () => ws.close();
  }, [roomId]);

  const sendMessage = (content) => {
    if (socket && socket.readyState === WebSocket.OPEN) {
      socket.send(JSON.stringify({ content, timestamp: Date.now() }));
    }
  };

  return { messages, sendMessage };
};
```

### ì±„íŒ… ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°
- **ChatRoom**: ì „ì²´ ì±„íŒ…ë°© ì»´í¬ë„ŒíŠ¸
- **MessageList**: ë©”ì‹œì§€ ëª©ë¡ í‘œì‹œ
- **MessageInput**: ë©”ì‹œì§€ ì…ë ¥
- **ParticipantList**: ì°¸ì—¬ì ëª©ë¡

## 4. Spring Boot ë°±ì—”ë“œ êµ¬í˜„

### ì±„íŒ…ë°© ì—”í‹°í‹° ì„¤ê³„
```java
@Entity
public class ChatRoom {
    @Id
    private Long productId;
    
    @Enumerated(EnumType.STRING)
    private ChatRoomStatus status;
    
    private int maxParticipants;
    private LocalDateTime createdAt;
    private LocalDateTime expiresAt;
    
    @OneToMany(mappedBy = "chatRoom", cascade = CascadeType.ALL)
    private List<ChatMessage> messages;
    
    @ManyToMany
    private Set<User> participants;
}
```

### WebSocket í•¸ë“¤ëŸ¬
```java
@Component
public class ChatWebSocketHandler extends TextWebSocketHandler {
    
    @Override
    public void afterConnectionEstablished(WebSocketSession session) {
        String roomId = extractRoomId(session);
        sessionManager.addSession(roomId, session);
    }

    @Override
    protected void handleTextMessage(WebSocketSession session, TextMessage message) {
        String roomId = extractRoomId(session);
        broadcastToRoom(roomId, message.getPayload());
    }
}
```

## 5. ì£¼ìš” ê¸°ëŠ¥ë³„ êµ¬í˜„ ì „ëµ

### ìë™ ì±„íŒ…ë°© ìƒì„±
- ìƒí’ˆ ë“±ë¡ ì‹œ `@EventListener` ì‚¬ìš©í•˜ì—¬ ì±„íŒ…ë°© ìë™ ìƒì„±
- ë¹„ë™ê¸° ì²˜ë¦¬ë¡œ ì„±ëŠ¥ ìµœì í™”

### ì‹œê°„ ê¸°ë°˜ ëª¨ì§‘ ê´€ë¦¬
- Spring Schedulerë¡œ ë§Œë£Œ ì‹œê°„ ì²´í¬
- Redisë¥¼ í™œìš©í•œ TTL(Time To Live) ì„¤ì •

### ì°¸ì—¬ì ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
- ì…ì¥/í‡´ì¥ ì‹œ ì „ì²´ ì°¸ì—¬ìì—ê²Œ ì•Œë¦¼
- í˜„ì¬ ì°¸ì—¬ ì¸ì› ì‹¤ì‹œê°„ í‘œì‹œ

### ë©”ì‹œì§€ íƒ€ì… ë¶„ë¥˜
- **CHAT**: ì¼ë°˜ ì±„íŒ… ë©”ì‹œì§€
- **SYSTEM**: ì‹œìŠ¤í…œ ì•Œë¦¼ (ì…ì¥, í‡´ì¥, ëª¨ì§‘ ì™„ë£Œ ë“±)
- **NOTIFICATION**: ì¤‘ìš” ê³µì§€ì‚¬í•­

## 6. ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„

### ë©”ì‹œì§€ ì €ì¥ ì „ëµ
- **ì‹¤ì‹œê°„**: Redisë¡œ ì„ì‹œ ì €ì¥
- **ì˜êµ¬**: MySQL/PostgreSQLë¡œ ë°±ì—…
- **íŒŒì¼**: ëŒ€ìš©ëŸ‰ íŒŒì¼ì€ ë³„ë„ ìŠ¤í† ë¦¬ì§€

### ì¸ë±ì‹± ì „ëµ
```sql
-- ì±„íŒ…ë°©ë³„ ë©”ì‹œì§€ ì¡°íšŒ ìµœì í™”
CREATE INDEX idx_chat_message_room_time ON chat_messages(chat_room_id, created_at);

-- ì‚¬ìš©ìë³„ ì°¸ì—¬ ì±„íŒ…ë°© ì¡°íšŒ
CREATE INDEX idx_participant_user_room ON chat_participants(user_id, chat_room_id);
```

## 7. ì„±ëŠ¥ ìµœì í™”

### ë©”ì‹œì§€ í˜ì´ì§•
- ìµœì‹  50ê°œ ë©”ì‹œì§€ë§Œ ì´ˆê¸° ë¡œë“œ
- ìŠ¤í¬ë¡¤ ì—… ì‹œ ê³¼ê±° ë©”ì‹œì§€ lazy loading

### ì—°ê²° ê´€ë¦¬
- ë¹„í™œì„± ì—°ê²° ìë™ ì •ë¦¬
- Connection Pool ìµœì í™”

### ìºì‹± ì „ëµ
- í™œì„± ì±„íŒ…ë°© ì •ë³´ Redis ìºì‹±
- ì°¸ì—¬ì ëª©ë¡ ë©”ëª¨ë¦¬ ìºì‹±

## 8. ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### ì¸ì¦/ì¸ê°€
- JWT í† í° ê¸°ë°˜ WebSocket ì¸ì¦
- ì±„íŒ…ë°© ì°¸ì—¬ ê¶Œí•œ ê²€ì¦

### ë©”ì‹œì§€ ê²€ì¦
- XSS ë°©ì§€ë¥¼ ìœ„í•œ HTML ì´ìŠ¤ì¼€ì´í”„
- ìŠ¤íŒ¸ ë°©ì§€ rate limiting

### ê°œì¸ì •ë³´ ë³´í˜¸
- ì±„íŒ… ë‚´ìš© ì•”í˜¸í™” ì €ì¥
- ê°œì¸ ì£¼ì†Œ ì •ë³´ ë³„ë„ ë³´ì•ˆ ì²˜ë¦¬

## 9. ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…

### ë©”íŠ¸ë¦­ ìˆ˜ì§‘
- ë™ì‹œ ì ‘ì†ì ìˆ˜
- ë©”ì‹œì§€ ì „ì†¡ ì„±ê³µ/ì‹¤íŒ¨ìœ¨
- ì‘ë‹µ ì‹œê°„

### ë¡œê¹… ì „ëµ
- ì±„íŒ…ë°© ìƒì„±/ì‚­ì œ ì´ë²¤íŠ¸
- ì—ëŸ¬ ë°œìƒ ì‹œ ìƒì„¸ ë¡œê·¸
- ì‚¬ìš©ì í–‰ë™ íŒ¨í„´ ë¶„ì„

## 10. ë°°í¬ ë° í™•ì¥ì„±

### ë©€í‹° ì¸ìŠ¤í„´ìŠ¤ í™˜ê²½
- Redis Pub/Subìœ¼ë¡œ ì„œë²„ ê°„ ë©”ì‹œì§€ ë™ê¸°í™”
- ë¡œë“œ ë°¸ëŸ°ì„œì—ì„œ Sticky Session ì„¤ì •

### ìˆ˜í‰ í™•ì¥
- ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ ê³ ë ¤
- ì±„íŒ… ì„œë¹„ìŠ¤ ë…ë¦½ ë°°í¬

---

í•µì‹¬ í¬ì¸íŠ¸ ìš”ì•½:

1. HTTP â†’ WebSocket ì—…ê·¸ë ˆì´ë“œ

í´ë¼ì´ì–¸íŠ¸ê°€ Upgrade: websocket í—¤ë”ë¡œ ì—…ê·¸ë ˆì´ë“œ ìš”ì²­

ì„œë²„ê°€ 101 Switching Protocolsë¡œ ì‘ë‹µ

ì´í›„ ì–‘ë°©í–¥ ì‹¤ì‹œê°„ í†µì‹  ê°€ëŠ¥


2. STOMPì˜ ì—­í• 

WebSocket ìœ„ì—ì„œ ë©”ì‹œì§• íŒ¨í„´ì„ í‘œì¤€í™”

pub/sub ëª¨ë¸ë¡œ ì±„íŒ…ë°© êµ¬ë…/ë°œí–‰ ì‰½ê²Œ êµ¬í˜„

/topic/chat/{roomId} ê°™ì€ destination íŒ¨í„´ ì§€ì›


3. ì‹¤ì œ êµ¬í˜„ì—ì„œì˜ íë¦„

ê±°ë˜ ì„œë¹„ìŠ¤ â†’ ì±„íŒ… ì„œë¹„ìŠ¤: POST /api/chat/rooms (ì±„íŒ…ë°© ìƒì„±)

í´ë¼ì´ì–¸íŠ¸ â†’ ì±„íŒ… ì„œë¹„ìŠ¤: WebSocket ì—°ê²° (/ws)

í´ë¼ì´ì–¸íŠ¸ â† â†’ ì„œë²„: STOMP í•¸ë“œì…°ì´í¬

í´ë¼ì´ì–¸íŠ¸: /topic/chat/{roomId} êµ¬ë…

ì‹¤ì‹œê°„ ë©”ì‹œì§€ ì†¡ìˆ˜ì‹  ì‹œì‘! ğŸš€